<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../css/plotGlass.css">
  </head>
  <body>
  <div id="plots"></div>
  <script src="../dist/plotGlass.js"></script>
  <script>

    /*
     * This example does a dirty, dirty hack to avoid needing to run a WebSocket server. For a better
     * example of how to use plotGlass, run timeSeries.html locally with the websocket server.
     */
    let generators = [];
    window.WebSocket = function(url){

      generators.push({
        ws : this,
        data : { accelX: 0.0 },
        x : Math.random(),
        magnitude : Math.random() * 100,
      })

      this.send = function(){};
    };
    setInterval(function(){
      for (let generator of generators) {
        generator.x +=.001;
        generator.data.accelX = (1 + Math.random() - 0.5) + Math.sin((generator.x) * generator.magnitude);
        generator.ws.onmessage({data:JSON.stringify(generator.data)});
      }
    },10)
    /* End of dirty hack */

    /* Beginning of PlotGlass example */
    let pg = new PlotGlass();
    pg.start();

    function addPlot() {
      let config = {

        container : "#plots",
        title : "Lots of signals",

        /** CSS styles which will be applied to the plot element */
        style:{
          width:"320px",
          height:"132px"
        },

        body: {
          majorDivs:[4, 4],
          minorDivs:[4, 4],
        },

        /** Properties specific to the plot axis */
        axes: {

          x1: {
            axis: "xBottom",
            range:[0, 5],
            title : "Time (s)",
            flipDirection: true,
            visible: true
          },

          y1: {
            axis: "yRight",
            range:[-.5, 3],
            title : "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Level",
            visible: true,
            flipDirection : false,
          },

        },

        /** Properties For the plot data */
        sources: {

          weather0 : {
            type: "WebSocketJson",
            url: "ws://localhost:8001",
            ackFrame: "",
          },

        },

        series : {
          weather0 : {
            type: "time",
            title: "Weather Station 0",
            axes: ["x1", "y1"],
            source: {
              name: "weather0",
              time: "$(time)",
              value: "accelX",
            },
            vertical: false,
            color: [1.00, 0.00, 0.75, 1.00],
          },
        }
      };

      for (let i =0; i < 20; i++) {
        let name = "weather"+i;
        config.sources[name] = {
          type: "WebSocketJson",
          url: "ws://localhost:8001",
          ackFrame: "",
        };

        config.series[name] = {
            type: "time",
            title: "Weather Station 0",
            axes: ["x1", "y1"],
            source: {
              name: name,
              time: "$(time)",
              value: "accelX",
            },
            vertical: false,
            color: [Math.random(), Math.random(), Math.random(), 1.00],
          }
      }


      pg.add(new Plot(config));
    }

    addPlot();
  </script>
  <p>
  <input type=button onclick="addPlot()" value="Add Plot" style="font-size:2em;font-weight:bold"></input>

  </body>
</html>